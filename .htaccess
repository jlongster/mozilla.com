AddType application/x-httpd-php .php .html
DirectoryIndex index.php index.html

ExpiresActive on
ExpiresDefault "access plus 15 minutes"
Options +MultiViews -Indexes

Header always set X-Robots-Tag "noodp"

SetEnvIfNoCase Request_URI "en-US/index.html" vary-ua
SetEnvIfNoCase Request_URI "en-US/firefox/(index|personal|upgrade|firefox).html" vary-ua
Header always set Vary "User-Agent" env=vary-ua

BrowserMatch "(Android|Maemo|Fennec|Linux\ armv7l)" is_mobile=yes
BrowserMatch "(?!(Android|Maemo|Fennec|Linux\ armv7l))" is_not_mobile=yes

RewriteEngine On

# certs
RewriteRule ^certs/mozilla-root\.crt\.md5sum$ includes/certs/mozilla-root.crt.md5sum [L]
RewriteRule ^certs/mozilla-root\.crt$ includes/certs/mozilla-root.crt [L]

# mozilla.com/labs -> mozillalabs.com
Redirect permanent /labs http://www.mozillalabs.com

# get involved redirect
Redirect permanent /getinvolved http://www.mozilla.com/about/get-involved

#firefox/releases/.htaccess
Redirect permanent /firefox/releases/2.0a1.html http://www.mozilla.org/projects/bonecho/releases/2.0a1.html
Redirect permanent /firefox/releases/2.0a2.html http://www.mozilla.org/projects/bonecho/releases/2.0a2.html
Redirect permanent /firefox/releases/2.0a3.html http://www.mozilla.org/projects/bonecho/releases/2.0a3.html
Redirect permanent /firefox/releases/2.0b1.html http://www.mozilla.org/projects/bonecho/releases/2.0b1.html
Redirect permanent /firefox/releases/2.0b2.html http://www.mozilla.org/projects/bonecho/releases/2.0b2.html
Redirect temp /firefox/releases/1.6a1.html http://www.mozilla.org/projects/minefield/releases/
Redirect temp /firefox/releases/3.0a1.html http://www.mozilla.org/projects/minefield/releases/

Redirect permanent /zh-CN/firefox/uninstall/ http://www.g-fox.cn/chn_feedback/uninstall.html

# Temporary rewrite for College page to JobVite page
RewriteRule ^en-US/college http://www.jobvite.com/CompanyJobs/Jobs.aspx?c=qpX9Vfwa

# Redirect release-candidate firstrun/whatsnew pages to out-of-date page (Bug 656721)
RewriteRule en-US/firefox/(3.6rc|4.0rc)(.*)/(whatsnew|firstrun)[/]? /en-US/firefox/out-of-date/ [PT,L]

# Redirect beta firstrun/whatsnew pages to out-of-date beta page (Bug 656721)
RewriteRule en-US/firefox/(3.6b|4.0b)(.*)/(whatsnew|firstrun)[/]? /en-US/firefox/out-of-date/beta.html [PT,L]

# Redirects for HP7 (Bug 665019)
# Firefox 4, 5, 6 and beyond folk
RewriteCond %{HTTP_USER_AGENT} ^.*Firefox/([4-9]\..*|[1-9][0-9]\..*)$
RewriteRule ^en-US/hp7(/)?$ /en-US/hp7/latest/
# Firefox 3.6 folk
RewriteCond %{HTTP_USER_AGENT} ^.*Firefox/3\.6.*$
RewriteRule ^en-US/hp7(/)?$ /en-US/hp7/3.6/
# Firefox 3.5 and earlier folk
RewriteCond %{HTTP_USER_AGENT} ^.*Firefox/(3\.5.*|3.0.*|2\..*|1\..*)$
RewriteRule ^en-US/hp7(/)?$ /en-US/hp7/3.5/
# Everyone else
RewriteRule ^en-US/hp7(/)?$ /en-US/hp7/new/

# Redirect all old firstrun versions to a out-of-date page
# NOTE:  you need to add exceptions here for normal firstrun pages!!
# bug 538486
RewriteCond $1 !^(?:3.6.*|6.*|7.*|8.*|9.*|sync|aurora)$
RewriteRule en-US/firefox/(.*)/(whatsnew|firstrun)[/]? /en-US/firefox/out-of-date/ [PT,L]

RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?products/[/]?$ /$1firefox [R=permanent]

# Redirects for mozillamessaging.com. bug 480373
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird[/]?$ http://www.mozilla.org/thunderbird/ [R=permanent]
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/index.html$ http://www.mozilla.org/thunderbird/ [R=permanent]
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?products/thunderbird[/]?$ http://www.mozilla.org/thunderbird/ [R=permanent]
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?products/thunderbird/features.html$ http://www.mozilla.org/thunderbird/features/ [R=permanent]
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/2.0.0.19/releasenotes[/]?$ http://www.mozillamessaging.com/thunderbird/2.0.0.19/releasenotes/ [R=permanent]
# RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/2.0.0.(2\d)/releasenotes[/]?$ http://www.mozillamessaging.com/$1thunderbird/2.0.0.$2/releasenotes/ [R=permanent]
# RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/all.html$ http://www.mozilla.org/thunderbird/all.html [R=permanent]

# # bug 578744
# RewriteRule en-US/thunderbird/(.*) http://www.mozillamessaging.com/en-US/thunderbird/$1 [R=permanent]

Redirect permanent /store http://store.mozilla.org

# thunderbird/releases/.htaccess
RewriteRule ^/thunderbird/releases/(.+?)-release-notes.html$ /thunderbird/releases/$1.html [R=permanent]

# Redirect the Thunderbird 3 release notes and start page to www.mozillamessaging.com (use en-US for everything currently)
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/(3(?:\.\d+){1,2}(?:[ab]\d)?(?:pre)?)/(releasenotes|start)(/.*)?$ http://www.mozillamessaging.com/en-US/thunderbird/$2/$3$4 [R=temp,L]

RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/privacy[/]?$ $1legal/privacy/ [PT]
RewriteRule ^extensions[/]?$ https://addons.mozilla.org/ [R=permanent,L]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?products/firefox(/.*)?$ $1firefox$2 [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?products/thunderbird(/.*)?$ $1thunderbird$2 [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/2.0rc[1-3]/releasenotes[/]?$ $1firefox/2.0/releasenotes/ [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/2.0.0.0rc[1-4]/releasenotes[/]?$ $1thunderbird/2.0.0.0/releasenotes/ [PT]
RewriteRule ^(?:\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/livebookmarks[/]?$ /firefox/livebookmarks.html [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/(2(?:\.\d+){1,3})pre(/.*)$ $1thunderbird/$2$3 [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?careers[/]?$ $1about/careers.html [PT]
RewriteRule ^(en-US|en-GB|fr|de)/add-ons/ebay/beta/$ https://addons.mozilla.org/ebay/ebay-extension/
RewriteRule ^en-US/add-ons/ebay/beta/update.rdf$ https://addons.mozilla.org/ebay/ebay-extension/update.rdf

# Bug 670114
RewriteRule ^(.+)/firefox/about[/]?$ /$1/about/ [PT,L]
RewriteRule ^support(?:/.*)?$ http://support.mozilla.com/ [R=permanent,L]

# Bug 376458
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/dictionaries.html$ https://addons.mozilla.org/thunderbird/dictionaries [R=permanent,L]

# Bug 424204
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?)?/firefox/help(?:/.*)?$ http://support.mozilla.com/$1/kb/ [R=permanent,L]

# Bug 437662
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefoxfeatures[/]?$ $1firefox/features/ [NC,PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefoxtips[/]?$ $1firefox/tips/ [NC,PT]

# Bug 437906
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/features.html$ /firefox/features/ [R=permanent]

# Bug 439472
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/vpat.html$ /firefox/vpat-3.html [R=permanent]

# Bug 439472
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?about/licensing.html$ http://www.mozilla.org/foundation/licensing.html [R=permanent]

# Bug 444603
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/addons[/]?$ /$1firefox/customize/ [R=permanent]

# Bug 630937
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/customize/getpersonal[/]?$ /$1firefox/customize/ [R=permanent]

# Bug 447602.  Redirects /products/firefox/central.html but is building on the /products/firefox/ -> /firefox/ redirect
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/central.html$ /$1firefox/central/ [R=permanent]

# Bug 644290
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?organic[/]?$ / [R=permanent]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/organic[/]?$ / [R=permanent]

# Bug 664261
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?mobile/download/?(?:index.html)?$ /mobile/ [R=permanent]

# Bug 663832
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/fastest/?(?:index.html)?$ / [R=permanent]

# Bug 662820
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/switch.html?$ / [R=permanent]

# Bug 453876
RewriteRule ^en-US/add-ons/kodak[/]?$ https://addons.mozilla.org/en-US/firefox/addon/4441 [R=permanent]

# Bug 502905
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/video/firefox-3.5.html$ /$1firefox/video/?video=meet [R=permanent]

# Bug 479262
RewriteRule ^(?:en-US/)?university/?(?:index.html)?$ https://wiki.mozilla.org/Education [R=permanent]

# Bug 524509
RewriteRule en-US/about/get-involved?(?:.html)?$ http://www.mozilla.org/contribute/ [R=permanent]

# Bug 656270
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?manyfaces[/]?$ http://www.mozilla.org/community/ [R=permanent]

# Bug 399466
RewriteRule en-US/legal/eula/(firefox|thunderbird)(.?)-(.+)\.(.+) /$3/legal/eula/$1$2.$4 [R=permanent]

# Bug 516495
RewriteRule ^en-US/about/trademarks/?(?:index.html)?$ http://www.mozilla.org/foundation/trademarks/list.html [R=permanent]

# Bug 612324
RewriteRule ^en-US/firefox/lang-packs/estonian.html?$ /et/ [R=permanent]
RewriteRule ^en-US/firefox/lang-packs/persian.html?$ /fa/ [R=permanent]
RewriteRule ^en-US/firefox/lang-packs/welsh.html?$ /cy/ [R=permanent]
RewriteRule ^en-US/firefox/lang-packs/tatar.html?$ https://addons.mozilla.org/en-US/firefox/addon/5295 [R=permanent]
RewriteRule ^en-US/firefox/lang-packs/friulian.html?$ https://addons.mozilla.org/it/firefox/addon/2057 [R=permanent]

# Bug 608370
RewriteRule ^en-US/press/kit-3-6.html$ /en-US/press/kits/#desktop [NE,R=permanent]
RewriteRule ^en-US/press/kit-4b.html$ /en-US/press/kits/#desktop [NE,R=permanent]
RewriteRule ^en-US/press/kit-N900.html$ /en-US/press/kits/#mobile [NE,R=permanent]
RewriteRule ^en-US/press/kit-android.html$ /en-US/press/kits/#mobile [NE,R=permanent]

# Bug 615715
RewriteRule ^en-US/press/media/$ /en-US/press/media/logos/ [R=permanent]

# Bug 620378
RewriteRule ^en-US/about/logo(/.*)*$ /en-US/press/media/logos/ [R=permanent]

# Bug 619303
RewriteRule ^en-US/press/images.html$ /en-US/press/media/logos/ [R=permanent]

# Bug 616237
# RewriteRule ^en-US/firefox/sync/$ /en-US/mobile/sync/ [R=permanent]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/sync[/]?$ /$1mobile/sync/ [R=permanent]

# Bug 644248
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.0/features[/]?$ /$1firefox/features/ [R=permanent]

# Bug 672802
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?add-ons/ebay[/]?$ https://addons.mozilla.org/$1firefox/addon/ebay-sidebar/ [R=permanent]

#### THUNDERBIRD PRODUCT REDIRECTS
#
# Older builds are not supported, so redirect to current builds page
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/all-older.html$ $1thunderbird/all.html [PT]

# Temporary rewrite for Thunderbird 2.0.0.24 beta
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird/2\.0\.0\.24/(releasenotes|start)(/(?:index.html)?)?$ $1thunderbird/2.0.0.24rc/$2$3 [PT]
#
#### END THUNDERBIRD PRODUCT REDIRECTS

#### FIREFOX PRODUCT REDIRECTS

# System requirements for an arbitrary version go to the major requirements
# First part of regex matches major (eg 2.0, 3.0, 3.5, 4.0)
# Second part of regex matches anything (eg b12, rc, .12rc, .0.1)# (see bug 586314)
RewriteRule ^(en-US/)?firefox/([0-9]\.[0-9]+)[^/]+/system-requirements(/(?:index.html)?)? /$1firefox/$2/system-requirements$3 [PT,L]

# Just to be safe, we will point anyone looking at the old-style system requirements to 5.0's
RewriteRule ^(en-US/)?firefox/system-requirements.html /$1firefox/5.0/system-requirements/ [PT,L]

# Merge Firefox 3.0, 3.0.x, 3.5, 3.6, 4.x, 5.x pages for locales only
# Redirect Firefox 2 whatsnew pages to oldversion page
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/2\.0\.0\.\d{1,2}/(firstrun|whatsnew)[/]?$ $1firefox/oldversion/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.0/(firstrun|whatsnew)[/]?$ $1firefox/oldversion/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.0\.\d{1,2}/(firstrun|whatsnew)[/]?$ $1firefox/oldversion/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.5/(firstrun|whatsnew)[/]?$ $1firefox/oldversion/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.5\.\d{1,2}/(firstrun|whatsnew)[/]?$ $1firefox/oldversion/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.6\.\d{1,2}/firstrun[/]?$ $1firefox/3.6/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.6\.\d{1,2}/whatsnew[/]?$ $1firefox/3.6/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.\d{1,2}/firstrun[/]?$ $1firefox/4/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.0\.\d{1,2}/whatsnew[/]?$ $1firefox/4/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.\d{1,2}/details[/]?$ $1firefox/4/details/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/5\.\d{1,2}/firstrun[/]?$ $1firefox/4/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/5\.0\.\d{1,2}/firstrun[/]?$ $1firefox/4/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/5\.\d{1,2}/whatsnew[/]?$ $1firefox/4/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/5\.0\.\d{1,2}/whatsnew[/]?$ $1firefox/4/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/5\.\d{1,2}/details[/]?$ $1firefox/4/details/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/6\.\d{1,2}/firstrun[/]?$ $1firefox/4/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/6\.0\.\d{1,2}/firstrun[/]?$ $1firefox/4/firstrun/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/6\.\d{1,2}/whatsnew[/]?$ $1firefox/4/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/6\.0\.\d{1,2}/whatsnew[/]?$ $1firefox/4/whatsnew/ [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/6\.\d{1,2}/details[/]?$ $1firefox/4/details/ [PT]


# Rewrite deleted beta/rc/RC pages to download page
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/(beta|rc|RC)[/]?$ /$1firefox/ [R=301]

# Bug 679916 Take down Firefox upgrade pages for locales
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/(gamer|socialmedia|worker|messaging|streamer)[/]?$ /$1firefox/ [R=301]


# Bug 660249 Update Mozilla.com for XP campaign
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/xp[/]?$ $1firefox/index.html?xp [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/XP[/]?$ $1firefox/index.html?xp [PT]

# Bug 666937, redirect old ab-CD/firefox/customize/ pages to addons.mozilla.org for locales
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/customize[/]?$ https://addons.mozilla.org/$1firefox/ [R,L]

# rewrite old ab-CD/firefox/tips/ pages to ab-CD/features/#madeeasy for locales
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/tips[/]?$ /$1firefox/features/#madeeasy [R,L,NE]

# rewrite old ab-CD/firefox/security/ pages to ab-CD/features/#advancedsecurity for locales
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/security[/]?$ /$1firefox/features/#advancedsecurity [R,L,NE]


# Bug 680147 Redirect updated ff users to /fx, locales only, specific template based on A/B testing
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond %{HTTP_USER_AGENT} ^.*Firefox/(4.*|5.*|6.*|7.*|8.*|9.*)$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox[/]?$ /$1firefox/fx/ [R=302,E=vary-ua]
# redirect everyone else to /new
RewriteCond $1 !en-(US|GB|ZA)/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox[/]?$ /$1firefox/new/ [R=302,E=vary-ua]

RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/fx[/]?$ $1firefox/index.html?fx [PT]
RewriteCond $1 !en-(US|GB|ZA)/
RewriteCond $1 !^$
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/new[/]?$ $1firefox/index.html?new [PT]



# Redirect Firefox all-beta and all-rc to the all download page (disabled while we have product betas/RCs available!)
# RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/all-(?:beta|rc).html$ $1firefox/all.html [PT]

# use all-beta content for all-rc
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/all-rc.html$ $1firefox/all-beta.html [PT]

# The Firefox 4 beta details update billboard is generic
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4.0b\d{1,2}/details[/]?$ $1firefox/4.0beta/details/ [PT]

# Redirect Firefox 4 Beta 1 whatsnew to firstrun (no difference in b1 between firstrun and whatsnew)
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4.0b1/whatsnew[/]?$ $1firefox/4.0b1/firstrun/ [PT]

# Redirect Firefox 3.6 Beta 1 whatsnew to firstrun (no difference in b1 between firstrun and whatsnew)
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3.6b1/whatsnew[/]?$ $1firefox/3.6b1/firstrun/ [PT]

# Redirect Firefox 3.6 Alpha 2 to Beta 1 (Alpha 2 was WinCE only and was actually the same as Beta 1, more or less)
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3.6a2/whatsnew[/]?$ $1firefox/3.6b1/firstrun/ [PT]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3.6a2/(releasenotes|firstrun)(/(?:index.html)?)?$ $1firefox/3.6b1/$2$3 [PT]

# Rewrites for Firefox 3.5 Beta 99 Preview Release
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3.5b99/(releasenotes)(/(?:index.html)?)?$ $1firefox/3.5pre/$2$3 [PT]


# Rapid Release channel redirects

# We are in beta for 7.0, redirect the "final" url to the beta pages
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?(firefox|mobile)/7\.0/(releasenotes|whatsnew|firstrun|details)(/(?:index.html|buglist.html)?)?$ $1$2/7.0beta/$3$4 [PT]

# Beta whatsnew -> firstrun
# (in the future, we should change this to match how we have been doing it for point releases below)
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?(firefox|mobile)/7\.0beta/whatsnew(/(?:index.html)?)? $1$2/7.0/firstrun$3 [PT]

# Redirect #.#b# to #.#beta
# See bug 658603 for the reason we need the condition
RewriteCond $3 !^(?:[1-4]\.[0-9]+)$
RewriteRule ^(en-US/)?(firefox|mobile)/([0-9]\.[0-9]+)b[0-9]+/(.*) /$1$2/$3beta/$4 [PT,L]


# Old development minor update redirects

# Temporary rewrite for Firefox 3.6 release candidate
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.6/(releasenotes|whatsnew|firstrun)(/(?:index.html)?)?$ $1firefox/3.6rc2/$2$3 [PT]

# Temporary rewrite for Firefox 3.5.19 beta
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.5\.19/(releasenotes|whatsnew)(/(?:index.html)?)?$ $1firefox/3.5.19rc/$2$3 [PT,L]

# Temporary rewrite for Firefox 3.6.20 beta
#RewriteRule ^(en-US/)?firefox/3\.6\.20(?:build[0-9]+)?/(releasenotes|whatsnew|details)(/(?:index.html)?)? /$1firefox/3.6.20rc/$2$3 [PT,L]

# Temporary rewrite for Firefox 4.0.1 beta
#RewriteRule ^(en-US/)?firefox/4\.0\.1(?:build[0-9]+)?/(releasenotes|whatsnew|details)(/(?:index.html)?)? /$1firefox/4.0.1rc/$2$3 [PT,L]

# Temporary rewrite for Firefox 3.5.19 firstrun -> 3.5.19 beta whatsnew
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.5\.19/firstrun(/(?:index.html)?)? $1firefox/3.5.19rc/whatsnew$3 [PT]

# Temporary rewrite for Firefox 3.6.20 firstrun -> 3.6.20 beta whatsnew
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.6\.20/firstrun(/(?:index.html)?)? $1firefox/3.6.20rc/whatsnew$3 [PT]

# Temporary rewrite for Firefox 4.0.1 firstrun -> 4.0.1 beta whatsnew
#RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.0\.1/firstrun(/(?:index.html)?)? $1firefox/4.0.1rc/whatsnew$3 [PT]

# Rewrite rule for 3.7a4webm build firstrun/whatsnew pages to webmproject.org (bug 566884)
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3.7a4webm/(whatsnew|firstrun)[/]?$ http://www.webmproject.org/ [R=temp,L]

# These are catch-alls and need to come after any beta firstrun overrides...
# (we can do these because of bug 573597)
# 3.5.x details/whatsnew always points to 3.5's version
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.5\.[0-9]+/details(/(?:index.html)?)?$ $1firefox/3.5/details$3 [PT,L]
# 3.6.x firstrun/details/whatsnew always points to 3.6's version
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/3\.6\.[0-9]+/(firstrun|details|whatsnew)(/(?:index.html)?)?$ $1firefox/3.6/$2$3 [PT,L]
# 4.0.x firstrun/details/whatsnew always points to 4.0's version
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/4\.0\.[0-9]+/(firstrun|details|whatsnew)(/(?:index.html|tour_.*)?)?$ $1firefox/4.0/$2$3 [PT,L]

# Special rewrite for some pages since they are hardcoded in Firefox source
RewriteRule ^firefox/its-a-trap.html$ /en-US/firefox/its-a-trap.html [L]
RewriteRule ^firefox/its-an-attack.html$ /en-US/firefox/its-an-attack.html [L]
#
#### END FIREFOX PRODUCT REDIRECTS

# Retired URLs.
RewriteRule ^en-US/launch[/]?$ /firefox/ [R=permanent]
RewriteRule ^en-US/firefox/updated[/]?$ /firefox/ [R=permanent]
RewriteRule ^en-US/firefox/landing(?:/.*)$ /firefox/ [R=permanent]
RewriteRule ^en-US/firefox/phase2(?:/.*)$ /firefox/ [R=permanent]
RewriteRule ^en-US/add-ons[/]?$ https://addons.mozilla.org/ [R=permanent,L]
RewriteRule ^en-US/developers[/]?$ http://developer.mozilla.org/ [R=permanent,L]
RewriteRule ^(?:en-US/)?fennec[/]?$ /en-US/mobile/ [R=permanent,L]
RewriteRule ^en-US/firefox/lorentz(?:/.*)$ / [R=permanent]

# to be used leading up to a release, as a way of diverting HTTP traffic from
# FTP mirrors - remove when the new version goes live
RewriteRule ^en-US/firefox/comingsoon[/]? /en-US/firefox/ [R=permanent]

RewriteRule ^en-US/firefox/underthehood[/]? /en-US/firefox/performance/ [R=permanent]

# bug 629381, /en-US/mobile/maemo -> /en-US/mobile/download/
RewriteRule ^en-US/mobile/maemo[/]?$ /en-US/mobile/download/ [R=permanent]

# bug 488327, firefox/mobile -> mobile
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/mobile(.*)[/]?$ /$1mobile$2 [R=permanent]

# mobile/1.0.0 -> mobile 1.0, bug 540011
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?mobile/1.0.0(.*)[/]?$ /$1mobile/1.0$2 [R=permanent]

# Bug 619404 Quickly redirect index page
# RewriteRule ^$ /fake-page.html [L]

# Bug 611692 Redirect Pre Dec, 2010 pages to new equivalents
## Fix MPL URL (bug 681806)
RewriteCond %{REQUEST_URI} !/MPL.*
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)[/]?(?:index.html)?$ /$1firefox/ [R=permanent]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/personal.*[/]?$ /$1firefox/ [R=permanent]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/upgrade.*[/]?$ /$1firefox/ [R=permanent]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/ie.*[/]?$ /$1firefox/ [R=permanent]

# /customize -> /firefox/customize
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?customize(.*)[/]?$ /$1firefox/customize$2 [R=permanent]

# check for /{locale}/firefox/{version}/firstrun/eu/
# if it doesn't exist, redirect to the regular firstrun page in that locale
# bug 546525
RewriteCond %{REQUEST_URI} ^/(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/.*/firstrun/eu.*$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/(.*)/firstrun/eu[/]? /$1firefox/$2/firstrun/ [R=temp,L]

RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?m/alpha[/]? /$1m/beta [R=temp,L]
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?M/BETA[/]? /$1m/beta [R=permanent,L]

# Redirect the Lorentz firstrun pages to the equivalent whatsnew page
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/(3.6(.*)plugin(.*))/firstrun/?$ /$1firefox/$2/whatsnew/ [R]

# l10n tweaks:
# Our new html includes should not be directly accessible
RedirectMatch permanent ^/(.*).inc.html? http://www.mozilla.com

# Temporary redirect for Mobile platform support until we have updated the list of supported platforms for all locales
RewriteCond $1 !en-US/
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?mobile/platforms[/]?$ /en-US/mobile/platforms/ [R=temp,L]

# All our pages hit this prefetch script.  This will determine the language and
# forward them to the right place.
Action init /includes/prefetch.php
AddHandler init .html

# If someone tries to go to an old-style URL (eg. http://www.mozilla.com/de/firefox/help)
# this handler will pick it up, detect the language, and if it's a "valid" page
# (despite the 404) it'll still forward them to the correct place.  If it's not a
# valid page, they'll get a localized 404 (if available)
ErrorDocument 403 /includes/prefetch.php
ErrorDocument 404 /includes/prefetch.php

# Setup URL Prettiness.  Special thanks to hopsonro for his apache voodoo.

# Handle file paths off the root, and add the locale back into the path
# based on the server name and/or domain.
# Examples:
#    http://{locale}.www.mozilla.com/firefox/central/ ->
#    http://{locale}.www.mozilla.com/{locale}/firefox/central/
RewriteCond %{SERVER_NAME} !^www\..*
RewriteCond %{SERVER_NAME} ^(\w{2,3})(-\w{2}(-mac)?)?\..*
RewriteCond %{REQUEST_URI} !^/(\w{2,3}(-\w{2}(-mac)?)?)(/.*)?$
RewriteCond %{SCRIPT_FILENAME} !^.*(php|css|js|jpg|gif|png|ico|pdf|swf)
RewriteRule ^(.*)$ /%1${toupper:%2}/$1 [R=permanent,L]

RewriteRule en-US/legal/privacy/firefox/mobile/(index.html)? /en-US/legal/privacy/ [R=301]

# Bug 582721
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?legal/privacy/firefox-en.html? /legal/privacy/firefox.html [R=permanent]

# Bug 651645 /beta -> /firefox/channel
RewriteRule ^beta/?$ /firefox/channel/ [R=302]
RewriteRule ^firefox/beta/?$ /firefox/channel/ [R=301]
RewriteRule ^RC/?$ /firefox/channel/ [R=302,NC]
RewriteRule ^firefox/RC/?$ /firefox/channel/ [R=302,NC]

# Bug 657903 /m/beta -> /m/firefox/channel
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?m/beta/? /$1m/firefox/channel/ [R=permanent]

# Bug 640038 redirect old beta and rc links
RewriteRule ^en-US/firefox/beta/features(/(index.html)?)?$ /en-US/firefox/features/ [R=301]
RewriteRule ^en-US/firefox/beta/technology(/(index.html)?)?$ /en-US/firefox/performance/ [R=301]
RewriteRule ^en-US/firefox/beta/faq(/(index.html)?)?$ /en-US/press/faq/fx4 [R=301]
RewriteRule ^en-US/firefox/beta(?:/(.*))?$ /en-US/firefox/ [R=301]

RewriteRule ^en-US/firefox/RC/features(/(index.html)?)?$ /en-US/firefox/features/ [R=301,NC]
RewriteRule ^en-US/firefox/RC/technology(/(index.html)?)?$ /en-US/firefox/performance/ [R=301,NC]
RewriteRule ^en-US/firefox/RC/faq(/(index.html)?)?$ /en-US/press/faq/fx4 [R=301,NC]
RewriteRule ^en-US/firefox/RC(?:/(.*))?$ /en-US/firefox/ [R=301,NC]

#Bug 660292 redirect fx4 faq to general fx faq
RewriteRule ^en-US/press/faq/fx4(/(index.html)?)?$ /en-US/press/faq/fx/ [R=301]

# Bug 640701 redirects stats page to glow
RewriteRule ^en-US/firefox/stats(/(index.html)?)?$ http://glow.mozilla.org/ [R=301]

# Bug 629407  & 659786 Redirect updated ff users to /fx
RewriteCond %{HTTP_USER_AGENT} ^.*Firefox/(6.*|7.*|8.*)$
RewriteRule ^en-US/firefox(/(index.html)?)?$ /en-US/firefox/fx/ [R=302]
# redirect everyone else to /new
RewriteRule ^en-US/firefox(/(index.html)?)?$ /en-US/firefox/new/ [R=302]

# Bug 672863
SetEnvIf Request_URI "/(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?mobile/?" vary-ua
RewriteCond %{ENV:is_mobile} yes
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?mobile/?$ /$1m [R=302]

# Bug 638948 redirect beta privacy policy link
RewriteRule ^en-US/firefox/beta/feedbackprivacypolicy/?$ /en-US/legal/privacy/firefox.html [R=permanent]

# Bug 638501 redirect /mobile/beta to /mobile
RewriteRule ^en-US/mobile/beta /en-US/mobile

# Bug make fx mobile rc1 look like real thing
RewriteRule ^en-US/mobile/4.0rc1/(.*)$ /en-US/mobile/4.0/$1 [P]

# Bug 644178 special redirect for google snippets (please remove when may 2011 snippets are online)
RewriteRule ^en/firefox/beta/$ /en-US/firefox/ [R=301]

# Bug 646078 deprecate /firefox/firefox.html
RewriteRule ^en-US/firefox/firefox.html /en-US/firefox/ [R=301]

# Bug 654614 /blocklist and /en-US/blocklist -> addons.m.o/blocked
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?blocklist(/(?:index.html)?)?$ https://addons.mozilla.org/blocked [R=permanent]


# Bug 655193
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?firefox/download/?$ / [R=permanent]

#### mozilla.org rewrites ####

# images, script, and style *should* be served from a CDN, but we
# still rewrite these just in case any page doesn't correctly use
# the CDN
RewriteRule ^images/(.*)$ /org/images/$1 [L]
RewriteRule ^script/(.*)$ /org/script/$1 [L]

# Catch-all for static files that should simply be served up by Apache.
# If it doesn't exist in moz.com, but does in moz.org, and is a static
# file, serve it up
RewriteCond %{REQUEST_URI} .*\.(css|png|jpg|jpeg|pdf)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}/org%{REQUEST_URI} -f
RewriteRule ^(.*)$ /org/$1 [L]

# Thunderbird doesn't use a CDN but luckily its media is all
# underneath the "thunderbird directory"
RewriteRule ^thunderbird/img/(.*)$ /org/thunderbird/img/$1 [L]
RewriteRule ^thunderbird/style/(.*)$ /org/thunderbird/style/$1 [L]
RewriteRule ^thunderbird/js/(.*)$ /org/thunderbird/js/$1 [L]

RewriteRule ^drumbeat/img/(.*)$ /org/drumbeat/img/$1 [L]
RewriteRule ^drumbeat/style/(.*)$ /org/drumbeat/style/$1 [L]
RewriteRule ^drumbeat/js/(.*)$ /org/drumbeat/js/$1 [L]

### handle mozilla.org and thunderbird URLs ###

# Check if we should throw a 410 for this URL (ported from
# mozilla.org's codebase)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond ${org-urls-410:$1} >""
RewriteRule ^(.*)$ ${org-urls-410:$1} [R=410]

# Check if we should throw a 301 for this URL (ported from
# mozilla.org's codebase)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond ${org-urls-301:$1} >""
RewriteRule ^(.*)$ ${org-urls-301:$1} [R=301]

# Let the thunderbird prefetch.php handle all its URLs
RewriteRule ^(\w{2,3}(?:-\w{2}(?:-mac)?)?/)?thunderbird(.*) /includes/thunderbird-handler.php [L]

### redirects moved over from mozilla.org ###

# XML namespace URI rewrites to prevent 404 errors
RewriteRule ^2004/em-rdf$ /script/namespace.php?id=em-rdf [L]
RewriteRule ^2005/app-update$ /script/namespace.php?id=update [L]
RewriteRule ^2006/addons-blocklist$ /script/namespace.php?id=addons-bl [L]
RewriteRule ^2006/browser/search/$ /script/namespace.php?id=mozsearch [L]
RewriteRule ^keymaster/gatekeeper/there.is.only.xul$ /script/namespace.php?id=xul [L]
RewriteRule ^microsummaries/0.1$ /script/namespace.php?id=microsummaries [L]
RewriteRule ^projects/xforms/2005/type$ /script/namespace.php?id=xforms-type [L]
RewriteRule ^xbl$ /script/namespace.php?id=xbl [L]

# Redirect /phonebook from HTTP to HTTPS
RewriteCond %{HTTP:SSLSessionID} ^$ [NC]
RewriteCond %{REQUEST_URI} ^/phonebook/
RewriteRule ^(.*)$ https://www.mozilla.org/$1 [R]

# Redirects for SeaMonkey project website, now living at seamonkey-project.org
Redirect permanent /projects/seamonkey/ http://www.seamonkey-project.org/
Redirect permanent /projects/seamonkey/artwork.html http://www.seamonkey-project.org/dev/artwork
Redirect permanent /projects/seamonkey/community.html http://www.seamonkey-project.org/community
Redirect permanent /projects/seamonkey/get-involved.html http://www.seamonkey-project.org/dev/get-involved
Redirect permanent /projects/seamonkey/index.html http://www.seamonkey-project.org/
Redirect permanent /projects/seamonkey/news.html http://www.seamonkey-project.org/news
Redirect permanent /projects/seamonkey/project-areas.html http://www.seamonkey-project.org/dev/project-areas
Redirect permanent /projects/seamonkey/releases/ http://www.seamonkey-project.org/releases/
Redirect permanent /projects/seamonkey/releases/index.html http://www.seamonkey-project.org/releases/
Redirect permanent /projects/seamonkey/review-and-flags.html http://www.seamonkey-project.org/dev/review-and-flags
RedirectMatch permanent ^/projects/seamonkey/releases/(1\..*).html$ http://www.seamonkey-project.org/releases/$1
RedirectMatch permanent ^/projects/seamonkey/releases/seamonkey(.*)/(.*).html$ http://www.seamonkey-project.org/releases/seamonkey$1/$2
RedirectMatch permanent ^/projects/seamonkey/releases/seamonkey(.*)/index.html$ http://www.seamonkey-project.org/releases/seamonkey$1/
RedirectMatch permanent ^/projects/seamonkey/releases/updates/(.*)$ http://www.seamonkey-project.org/releases/updates/$1
RedirectMatch permanent ^/projects/seamonkey/start/ http://www.seamonkey-project.org/start/

RedirectMatch permanent ^/(licensing|LICENSING) http://www.mozilla.org/foundation/licensing.html
RedirectMatch permanent /js/language/js20(/.*)$ http://www.ecmascript-lang.org
RedirectMatch permanent /js/language/es4(/.*)$ http://www.ecmascript-lang.org
RedirectMatch permanent /parks(/.*)$ http://chelseanovak.wordpress.com/2011/07/08/looking-back-on-mozilla-parks/
RedirectMatch permanent /projects/xpcom/book.* https://developer.mozilla.org/en/Creating_XPCOM_Components
RedirectMatch permanent /projects/xpcom/doc.* https://developer.mozilla.org/en/XPCOM

# Fix for reed
RewriteRule ^security/phishing-test/?$ /security/phishing-test.html  [R]

RewriteRule ^join/thankyou\.en\.html$ join/thankyou.php?locale=en_US
RewriteRule ^join/thankyou\.de\.html$ join/thankyou.php?locale=de_DE

RedirectMatch temp ^/projects/firefox/.*pre/whatsnew/ http://www.mozilla.org/contribute/

RewriteRule ^about/manifesto(?:/(?:index.html)?)?$ http://www.mozilla.org/about/manifesto.en.html [R]
RewriteRule ^about/staff(?:/(?:index.html)?)?$ http://www-archive.mozilla.org/about/staff.html [R]
RewriteRule ^access/dhtml(?:/(?:index.html)?)?$ http://wiki.codetalks.org/wiki/index.php/Main_Page [R]
RewriteRule ^access/unix/atspi-support(?:/(?:index.html)?)?$ http://developer.mozilla.org/En/Accessibility:AT-APIs [R]
RewriteRule ^badges(?:/(?:index.html)?)?$ http://wiki.mozilla.org/Badges [R]
RewriteRule ^betterinternet(?:/(?:index.html)?)?$ http://www.mozilla.org/causes/better.html [R]
RewriteRule ^bugs(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/Bug_writing_guidelines [R]
RewriteRule ^build(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/Build_Documentation [R]
RewriteRule ^catalog/architecture/xul(?:/(?:index.html)?)?$ http://developer.mozilla.org/En/XUL [R]
RewriteRule ^catalog/web-developer(?:/(?:index.html)?)?$ http://developer.mozilla.org/En/Web_Development [R]
RewriteRule ^causes(?:/(?:index.html)?)?$ http://www.mozilla.org/about/mission.html [R]
RewriteRule ^causes/onewebday(?:/(?:index.html)?)?$ http://commonspace.wordpress.com/2010/04/06/owddrumbeat/ [R]
RewriteRule ^causes/onewebday/posters(?:/(?:index.html)?)?$ http://commonspace.wordpress.com/2010/04/06/owddrumbeat/ [R]
RewriteRule ^causes/subtitles(?:/(?:index.html)?)?$ http://www.drumbeat.org/universal-subtitles/ [R]
RewriteRule ^community/forums(?:/(?:index.html)?)?$ http://www.mozilla.org/about/forums/ [R]
RewriteRule ^community/intl(?:/(?:index.html)?)?$ http://www.mozilla.org/community/directory.html [R]
RewriteRule ^contribute/writing(?:/(?:index.html)?)?$ https://developer.mozilla.org/Project:en/How_to_Help [R]
RewriteRule ^contribute/writing/cvs(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Mozilla.org:How_to_Work_with_Site [R]
RewriteRule ^contribute/writing/(guidelines|guidelines.html)(\/?)$ https://wiki.mozilla.org/Websites/Guides/Style [R]
RewriteRule ^contribute/writing/how-to(?:/(?:index.html)?)?$ https://developer.mozilla.org/Project:en/How_to_document_Mozilla [R]
RewriteRule ^contribute/writing/process(?:/(?:index.html)?)?$ https://developer.mozilla.org/Project:en/Getting_started [R]
RewriteRule ^directory(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Directory [R]
RewriteRule ^docs(?:/(?:index.html)?)?$ https://developer.mozilla.org/ [R]
RewriteRule ^docs/docshell(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/DocShell [R]
RewriteRule ^docs/dom(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/About_the_Document_Object_Model [R]
RewriteRule ^docs/dom/domref(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/Gecko_DOM_Reference [R]
RewriteRule ^docs/tutorials/tinderstatus(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/Creating_a_Mozilla_Extension [R]
RewriteRule ^docs/web-developer(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Web_Development [R]
RewriteRule ^docs/web-developer/js(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/JavaScript [R]
RewriteRule ^docs/web-developer/js/debugging(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/Debugging_JavaScript [R]
RewriteRule ^donate(?:/(?:index.html)?)?$ https://donate.mozilla.org/page/contribute/openwebfund [R]
RewriteRule ^download http://www.mozilla.org/projects/ [R]
RewriteRule ^firefox-live/blog(?:/(?:index.html)?)?$ http://firefoxlive.mozilla.org/blog [R]
RewriteRule ^foundation/blog(?:/(?:index.html)?)?$ http://blog.mozillafoundation.org/ [R]
RewriteRule ^foundation/donate(?:/(?:index.html)?)?$ https://donate.mozilla.org/page/contribute/openwebfund [R]
RewriteRule ^foundation/grants(?:/(?:index.html)?)?$ http://www.mozilla.org/grants [R]
RewriteRule ^foundation/openwebfund(?:/(?:index.html)?)?$ https://donate.mozilla.org/page/contribute/openwebfund [R]
RewriteRule ^hacking(?:/(?:index.html)?)?$ https://developer.mozilla.org/En/Developer_Guide [R]
RewriteRule ^hacking/patch-maker(?:/(?:index.html)?)?$ http://www.gerv.net/software/patch-maker/ [R]
RewriteRule ^internethealth(?:/(?:index.html)?)?$ http://www.mozilla.org/causes/serviceweek/internethealth/ [R]
RewriteRule ^js(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/About_JavaScript [R]
RewriteRule ^js/language(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/JavaScript_Language_Resources [R]
RewriteRule ^js/spidermonkey(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/SpiderMonkey [R]
RewriteRule ^lightning(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/calendar/ [R]
RewriteRule ^mailnews(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Thunderbird [R]
RewriteRule ^mission(?:/(?:index.html)?)?$ http://www.mozilla.org/about/mission.html [R]
RewriteRule ^onewebday(?:/(?:index.html)?)?$ http://commonspace.wordpress.com/2010/04/06/owddrumbeat/ [R]
RewriteRule ^open(?:/(?:index.html)?)?$ http://www.mozilla.org/causes/open/ [R]
RewriteRule ^openwebfund(?:/(?:index.html)?)?$ http://www.mozilla.org/foundation/openwebfund/ [R]
RewriteRule ^parks/firefoxlive(?:/(?:index.html)?)?$ http://firefoxlive.mozilla.org/ [R]
RewriteRule ^performance(?:/(?:index.html)?)?$ http://wiki.mozilla.org/Performance:Home_Page [R]
RewriteRule ^policies(?:/(?:index.html)?)?$ http://www.mozilla.org/about/policies/ [R]
RewriteRule ^ports/qtmozilla(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Qt [R]
RewriteRule ^poweredby(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/powered-by.html [R]
RewriteRule ^press/testimonials(?:/(?:index.html)?)?$ /press/ [R]
RewriteRule ^products(?:/(?:index.html)?)?$ http://www.mozilla.org/projects [R]
RewriteRule ^products/firefox(?:/(?:index.html)?)?$ http://www.firefox.com [R]
RewriteRule ^products/firefox/affiliates(?:/(?:index.html)?)?$ http://www.spreadfirefox.com/affiliates [R]
RewriteRule ^products/firefox/buttons(?:/(?:index.html)?)?$ http://www.spreadfirefox.com/affiliates [R]
RewriteRule ^products/mozilla1.x(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/ [R]
RewriteRule ^products/mozilla1.x/download(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/ [R]
RewriteRule ^products/thunderbird(?:/(?:index.html)?)?$ http://www.mozilla.org/thunderbird/ [R]
RewriteRule ^products/thunderbird/why(?:/(?:index.html)?)?$ http://www.mozilla.org/thunderbird/features/ [R]
RewriteRule ^projects/bonecho(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/bonsai(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Bonsai [R]
RewriteRule ^projects/camino(?:/(?:index.html)?)?$ http://caminobrowser.org/ [R]
RewriteRule ^projects/cck(?:/(?:index.html)?)?$ https://wiki.mozilla.org/CCK [R]
RewriteRule ^projects/chimera(?:/(?:index.html)?)?$ http://caminobrowser.org/ [R]
RewriteRule ^projects/deerpark(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/devpreview(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/embedding(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Embedding_Mozilla [R]
RewriteRule ^projects/fennec(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Fennec [R]
RewriteRule ^projects/granparadiso(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/inspector(?:/(?:index.html)?)?$ https://developer.mozilla.org/En/DOM_Inspector [R]
RewriteRule ^projects/javaconnect(?:/(?:index.html)?)?$ http://developer.mozilla.org/en/JavaXPCOM [R]
RewriteRule ^projects/marketing(?:/(?:index.html)?)?$ http://contribute.mozilla.org/Marketing [R]
RewriteRule ^projects/mathml(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Mozilla_MathML_Project [R]
RewriteRule ^projects/mathml/fonts(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Mozilla_MathML_Project/Fonts [R]
RewriteRule ^projects/mathml/screenshots(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Mozilla_MathML_Project/Screenshots [R]
RewriteRule ^projects/minefield(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/firefox/prerelease.html [R]
RewriteRule ^projects/minimo(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Mobile [R]
RewriteRule ^projects/namoroka(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/netlib(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Necko [R]
RewriteRule ^projects/plugins(?:/(?:index.html)?)?$ https://developer.mozilla.org/En/Plugins [R]
RewriteRule ^projects/rt-messaging(?:/(?:index.html)?)?$ http://chatzilla.hacksrus.com/ [R]
RewriteRule ^projects/rt-messaging/chatzilla(?:/(?:index.html)?)?$ http://chatzilla.hacksrus.com/ [R]
RewriteRule ^projects/shiretoko(?:/(?:index.html)?)?$ http://www.mozilla.com/firefox/channel/ [R]
RewriteRule ^projects/string(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XPCOM_string_guide [R]
RewriteRule ^projects/tech-evangelism(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Evangelism [R]
RewriteRule ^projects/venkman(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/Venkman [R]
RewriteRule ^projects/webservices/examples/babelfish-wsdl(?:/(?:index.html)?)?$ http://developer.mozilla.org/En/XML_Web_Services [R]
RewriteRule ^projects/xbl(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XBL [R]
RewriteRule ^projects/xforms(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XForms [R]
RewriteRule ^projects/xpcom(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XPCOM [R]
RewriteRule ^projects/xpinstall(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XPInstall [R]
RewriteRule ^projects/xslt(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XSLT [R]
RewriteRule ^projects/xul(?:/(?:index.html)?)?$ https://developer.mozilla.org/En/XUL [R]
RewriteRule ^quality(?:/(?:index.html)?)?$ http://quality.mozilla.org/ [R]
RewriteRule ^quality/help(?:/(?:index.html)?)?$ http://quality.mozilla.org/get-involved [R]
RewriteRule ^releases(?:/(?:index.html)?)?$ http://www.mozilla.org/projects [R]
RewriteRule ^roadmap(?:/(?:index.html)?)?$ https://wiki.mozilla.org/Roadmap_Scratchpad [R]
RewriteRule ^school(?:/(?:index.html)?)?$ http://education.mozilla.org [R]
RewriteRule ^scriptable(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XPConnect [R]
RewriteRule ^scriptable/xpidl(?:/(?:index.html)?)?$ https://developer.mozilla.org/en/XPIDL [R]
RewriteRule ^serviceweek(?:/(?:index.html)?)?$ http://www.mozilla.org/causes/serviceweek/ [R]
RewriteRule ^status(?:/(?:index.html)?)?$ https://wiki.mozilla.org/WeeklyUpdates [R]
RewriteRule ^sunbird(?:/(?:index.html)?)?$ http://www.mozilla.org/projects/calendar/ [R]
RewriteRule ^university(?:/(?:index.html)?)?$ http://education.mozilla.org [R]
RewriteRule ^university/demos/xslt(?:/(?:index.html)?)?$ http://education.mozilla.org [R]
RewriteRule ^xpfe(?:/(?:index.html)?)?$ http://developer.mozilla.org/En/Toolkit_API [R]

### Handle all of the mozilla.org URLs.
#
# org-handler.php is the new prefetch.php which handles the
# mozilla.org URLs. We only take over the homepage and about page if
# the org site is available at the /org directory. Also, many of the
# URLs are only here because they redirect to the archive site.

RewriteCond %{DOCUMENT_ROOT}/org -d
RewriteRule ^$ /includes/org-handler.php [L]

RewriteCond %{DOCUMENT_ROOT}/org -d
RewriteRule ^about.* /includes/org-handler.php [L]

RewriteRule ^faq.html$ /includes/org-handler.php [L]
RewriteRule ^access.* /includes/org-handler.php [L]
RewriteRule ^banners.* /includes/org-handler.php [L]
RewriteRule ^book.* /includes/org-handler.php [L]
RewriteRule ^causes.* /includes/org-handler.php [L]
RewriteRule ^community.* /includes/org-handler.php [L]
RewriteRule ^contact.* /includes/org-handler.php [L]
RewriteRule ^(contribute.*.png) /org/$1 [L] # required for special img dir
RewriteRule ^contribute.* /includes/org-handler.php [L]
RewriteRule ^credits.* /includes/org-handler.php [L]
RewriteRule ^(css.*)$ /org/$1 [L]
RewriteRule ^developer.* /includes/org-handler.php [L]
RewriteRule ^directory.* /includes/org-handler.php [L]
RewriteRule ^docs.* /includes/org-handler.php [L]
RewriteRule ^drumbeat.* /includes/org-handler.php [L]
RewriteRule ^editor.* /includes/org-handler.php [L]
RewriteRule ^foundation.* /includes/org-handler.php [L]
RewriteRule ^hacking.* /includes/org-handler.php [L]
RewriteRule ^grants.* /includes/org-handler.php [L]
RewriteRule ^hacking.* /includes/org-handler.php [L]
RewriteRule ^images.* /includes/org-handler.php [L]
RewriteRule ^keymaster.* /includes/org-handler.php [L]
RewriteRule ^join.* /includes/org-handler.php [L]
RewriteRule ^js/scripting.* /includes/org-handler.php [L]
RewriteRule ^keymaster.* /includes/org-handler.php [L]
RewriteRule ^legal.* /includes/org-handler.php [L]
RewriteRule ^mailnews.* /includes/org-handler.php [L]
RewriteRule ^MPL.* /includes/org-handler.php [L]
RewriteRule ^newlayout.* /includes/org-handler.php [L]
RewriteRule ^parks.* /includes/org-handler.php [L]
RewriteRule ^performance.* /includes/org-handler.php [L]
RewriteRule ^phonebook.* /includes/org-handler.php [L]
RewriteRule ^ports.* /includes/org-handler.php [L]
RewriteRule ^privacy.* /includes/org-handler.php [L]
RewriteRule ^projects.* /includes/org-handler.php [L]
RewriteRule ^rdf.* /includes/org-handler.php [L]
RewriteRule ^rhino.* /includes/org-handler.php [L]
RewriteRule ^script.* /includes/org-handler.php [L]
RewriteRule ^scriptable.* /includes/org-handler.php [L]
RewriteRule ^security.* /includes/org-handler.php [L]
RewriteRule ^start.* /includes/org-handler.php [L]
RewriteRule ^themes.* /includes/org-handler.php [L]
RewriteRule ^unix.* /includes/org-handler.php [L]

#### end mozilla.org rewrites ####

<FilesMatch "\.(ttf|woff|eot)$">
    ExpiresActive On
    ExpiresDefault "access plus 10 years"
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

AddDefaultCharset UTF-8
AddType image/x-icon .ico
AddType text/xml .rdf

# The following types were ported from the old mozilla.org

# Add text types
AddType text/calendar .ics
AddType text/x-component .htc
AddType text/xml .rdf

# Add image types
AddType image/svg+xml .svg
AddType image/x-icon .ico

# Add Mozilla application types
AddType application/vnd.mozilla.xul+xml .xul
AddType application/x-xpinstall .xpi

# Add StarOffice document types
AddType application/vnd.stardivision.calc .sdc
AddType application/vnd.stardivision.draw .sda
AddType application/vnd.stardivision.impress .sdd
AddType application/vnd.stardivision.writer .sdw

<IfModule mod_deflate.c>
  <FilesMatch "\.(js|css)$">
    SetOutputFilter DEFLATE
  </FilesMatch>
</IfModule>

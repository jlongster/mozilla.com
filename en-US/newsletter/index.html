<?php
    // The $body_* variables are for compatibility with pre-existing css
    $page_title = 'Mozilla Newsletter';
    $body_id    = 'newsletter';
    $extra_headers = <<<EXTRA_HEADERS
    <link rel="stylesheet" href="{$config['static_prefix']}/style/covehead/newsletter.css" media="screen">
    <meta name="WT.si_n" content="newsletter">
    <meta name="WT.si_x" content="1">
EXTRA_HEADERS;

    include_once "{$config['file_root']}/{$lang}/includes/header.inc.php";
    require_once "{$config['file_root']}/includes/regions.php";
    require_once "{$config['file_root']}/includes/email/forms.php";

    $status = '';

    if(isset($_POST['target']) && $_POST['target'] == 'main') {
        $form = new NewsletterForm('MOZILLA_AND_YOU', $_POST);
        if ($form->save()) {
            $status = 'success';
        } elseif ($form->error) {
            $status = 'error-'. $form->error;
        }
    }
    else {
        $form = new NewsletterForm('MOZILLA_AND_YOU', array());
    }

   echo "RESPONSYS ::" . $config['responsys_id'] . "::";

?>



<div id="main-feature">
    <h2>Read all about it in our <span>newsletter</span></h2>
    <p>Subscribe to monthly updates and keep current with Mozilla news, including the latest tips and tricks for getting the most out of your Firefox browser. It’s the perfect way for us to keep in touch!</p>
</div>

<div id="content">

<ul class="email-form <?= $status ?>" id="newsletter-form">
    <li class="form-pane">
      <form action="" method="post">
        <input type="hidden" name="target" value="main" />

        <p class="form-error email-error"><span>Whoops! Be sure to enter a valid email address.</span></p>
        <p class="form-error privacy-error"><span>Please read the Mozilla Privacy Policy and agree by checking the box.</span></p>

        <div class="field required email-field">
          <label for="email">Your email address:</label>
          <span class="error-wrapper"><input name="email" type="email" class="email" value="<?= $form->get('email') ?>" autofocus></span>
        </div>

        <div class="field country-field">
          <label for="country">Country:</label>
          <select class="country" name="country">
            <option value="">Select country</option>
            <?php 
                $country = $form->get('country');
                if (!$country) {
                    $country = 'us';
                }
                echo regionsAsOptions($lang, $country);
            ?>
          </select>
        </div>

        <div class="field format-field">
          <?php
              $html_format = 'checked="checked"';
              $text_format = '';
              if ($form->get('format') == 'text') {
                  $text_format = 'checked="checked"';
                  $html_format = '';
              }
          ?>
          <span class="field-label">Format:</span>
          <div class="field-radios">
            <span class="radio-wrapper"><input type="radio" name="format" class="html-format" value="html" <?= $html_format?>></span>
            <label for="html-format">HTML</label>
            <span class="radio-wrapper"><input type="radio" name="format" class="text-format" value="text" <?= $text_format?>></span>
            <label for="text-format">Text</label>
          </div>
        </div>

        <div class="field privacy-field">
          <label for="privacy-check" class="privacy-check-label">
            <? $checked = $form->get('privacy') ? 'checked="checked"' : '' ?>
            <span class="error-wrapper"><input type="checkbox" name="privacy" class="privacy-check" <?= $checked ?>></span>
            <span class="title">I agree to the <a href="/en-US/privacy-policy">Mozilla Privacy Policy</a></span>
          </label>
        </div>

        <div class="field submit-field">
          <input onclick="dcsMultiTrack(
                            'DCS.dcssip', 'www.mozilla.com',
                            'DCS.dcsuri', '/en-us/newsletter',
                            'WT.ti', 'Link: Mozilla Newsletter',
                            'WT.dl', 99,
                            'WT.z_convert', 'newsletter',
                            'WT.si_n', 'newsletter',
                            'WT.si_x', '2');"
                 name="submit" 
                 type="submit" 
                 value="Sign me up!" 
                 class="subscribe">
        </div>

        <p class="disclaimer">We will only send you Mozilla-related information.</p>
      </form>
    </li>

    <li class="success-pane">
      <h3>Thanks for Subscribing!</h3>
      <p>Now you will be among the first to see Mozilla’s special events, product updates, videos and other awesomeness.</p>
      <p><a href="/<?=$lang?>/firefox/connect/" class="stay-connected">Stay Connected »</a></p>
    </li>
</ul>


</div><!-- end #content div -->

<?php if ($status == 'success'): ?>
  <script>
    $(function() {
        dcsMultiTrack('WT.si_n', 'Main Newsletter Subscribe', 'WT.si_x', '1', 'WT.si_cs', '1');
      });
  </script>
<?php endif ?>

<script src="<?php echo "{$config['static_prefix']}/js/autofocus.js"; ?>"></script>

<?php
    include_once "{$config['file_root']}/{$lang}/includes/footer.inc.php";
?>

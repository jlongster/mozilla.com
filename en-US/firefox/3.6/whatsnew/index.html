<?php

include_once "{$config['file_root']}/includes/headers/3.6/whatsnew.inc.php";

$page_title = 'Firefox Updated';
include_once "{$config['file_root']}/{$lang}/includes/headers/3.6/portal-pages.inc.php";

$_version       = getVersionBySelf();
$_valid_version = isValidVersionByReleaseNotes($_version, $config['file_root'], $lang);

$should_upgrade = (strpos($_SERVER['HTTP_USER_AGENT'], 'PPC') === FALSE &&
                   strpos($_SERVER['HTTP_USER_AGENT'] , 'Mac OS X 10.4') === FALSE);

?>


<div id="main-feature">
    <img src="<?php echo min_inline_image('/img/firefox/3.6/firstrun/logo.png')?>" alt="Firefox Logo" id="title-logo" width="128" height="130" />
<?php // check if there is a version
if ($_version !== null && $_valid_version) {
    // check if we’re running the latest version
    if (strcmp($_version, LATEST_FIREFOX_VERSION) == 0) {
        ?>
        <h2>Thanks for upgrading to Firefox <?=$_version?></h2>
        <p id="main-feature-contents">And for supporting 
          <a href="http://www.mozilla.org/about/mission.html"
             onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.org', 'DCS.dcsuri', '/about/mission.html', 'WT.ti', 'Mission');">
            Mozilla’s mission
          </a> of promoting openness, innovation and opportunity on the Web!</p>
        <?php
    } else {
        ?>
        <h2>You’re now running Firefox <?=$_version?></h2>
        <?php if($should_upgrade) { ?>
        <p id="main-feature-contents">For security reasons, we recommend downloading the <a href="/<?=$lang?>/firefox/">latest and greatest version</a>.</p>
        <?php
            }
    }
} else {
    ?>
    <h2 class="unknown-version">You’re running an unknown version of Firefox.</h2>
    <?php if($should_upgrade) { ?>
    <p id="main-feature-contents">For security reasons, we recommend downloading the <a href="/<?=$lang?>/firefox/">latest and greatest version</a>.</p>
    <?php
        }
}
?>
</div>

<?php 
   // Don't show Firefox 4 download promo for PPC or OS X 10.4 users
   if($should_upgrade) {
?>

<div id="main-content" class="beta-promo">
   <h3><span>Firefox 4 is here!</span></h3>
    <p>Upgrade today to the latest version:</p>
    <ul>
        <li>Awesomely fast</li>
        <li>Brand new look</li>
        <li>Tons of new features</li>
    </ul>
    <ul class="link"><li>
        <a href="/<?=$lang?>/firefox/?WT.mc_id=ba3613&amp;WT.mc_ev=click"
           onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                  'DCS.dcsuri', '/<?=$lang?>/firefox/beta/',
                                  'WT.ti', 'Link: Try the Beta',
                                  'WT.dl', 99,
                                  'WT.nv', 'Content',
                                  'WT.ac', 'Beta');">
          Download now!
        </a>
    </li></ul>
</div>

<?php } ?>

<div id="sidebar">


<?php
    $newsletter_wt_subscribe_uri = '/button/firstrun/newsletter_subscribe.html';
    $newsletter_wt_subscribe_ti = 'First%20Run%20Newsletter%20Subscribe';
    $newsletter_wt_blade_uri = '/button/firstrun/newsletter_blade.html';
    $newsletter_wt_blade_ti = 'First%20Run%20Newsletter%20Blade';

    require_once "{$config['file_root']}/includes/regions.php";
    require_once "{$config['file_root']}/includes/email/forms.php";

    $newsletter_wt_subscribe_uri = isset($newsletter_wt_subscribe_uri) ? $newsletter_wt_subscribe_uri : '';
    $newsletter_wt_subscribe_ti = isset($newsletter_wt_subscribe_ti) ? $newsletter_wt_subscribe_ti : '';
    $newsletter_wt_blade_uri = isset($newsletter_wt_blade_uri) ? $newsletter_wt_blade_uri : '';
    $newsletter_wt_blade_ti = isset($newsletter_wt_blade_ti) ? $newsletter_wt_blade_ti : '';

    $form = new NewsletterForm('MOZILLA_AND_YOU', $_POST);
    $status = '';
    if ($form->save()) {
        $status = 'success';
    } elseif ($form->error) {
        $status = 'error error-'. $form->error;
    }
?>
    <div class="sub-feature <?= $status ?>" id="newsletter"><div class="container">

        <form id="email-form" action="#email-form" method="post">
        <ul class="<?= $status ?>">
            <li id="open-pane" data-wt_uri="<?= $newsletter_wt_blade_uri ?>" data-wt_ti="<?= $newsletter_wt_blade_ti ?>">
                <h3>Get Monthly News</h3>
                <p>Product info, tips &amp; tricks and much more.</p>
                <div id="email-field" class="field">
                    <span class="error-wrapper">
                        <input
                            id="email"
                            name="email"
                            type="email"
                            placeholder="Your Email Address"
                            value="<?= $form->get('email') ?>"
                            class="<?= ($form->get('email') == '') ? 'placeholder' : '' ?>">
                    </span>
                    <a id="email-open"
                        href="/<?php echo $lang; ?>/newsletter/"
                        onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                               'DCS.dcsuri', '/mainstream_newsletter/step1', 
                                               'WT.ti', 'Link: Monthly News - First Step',
                                               'WT.dl', 99,
                                               'WT.nv', 'Content',
                                               'WT.ac', 'Newsletter');">»</a>
                </div>
            </li>
            <li id="form-pane">
                <p class="form-error" id="email-error"><span>Whoops! Be sure to enter a valid email address.</span></p>
                <p class="form-error" id="privacy-error"><span>Please read the Mozilla Privacy Policy and agree by checking the box.</span></p>
                <div id="form-details">

                    <div class="field" id="country-field">
                        <select id="country" name="country">
                            <option value="">Select country</option>
                            <?php
                                $country = $form->get('country');
                                if (!$country) {
                                    $country = 'us';
                                }
                                echo regionsAsOptions($lang, $country);
                            ?>
                        </select>
                    </div>

                    <div class="field" id="format-field">
                        <?php
                            $html_format = 'checked="checked"';
                            $text_format = '';
                            if ($form->get('format') == 'text') {
                                $text_format = 'checked="checked"';
                                $html_format = '';
                            }
                        ?>
                        <div class="field-radios">
                            <span class="radio-wrapper"><input type="radio" name="format" id="html-format" value="html" <?= $html_format?>></span>
                            <label for="html-format">HTML</label>
                            <span class="radio-wrapper"><input type="radio" name="format" id="text-format" value="text" <?= $text_format?>></span>
                            <label for="text-format">Text</label>&nbsp;
                        </div>
                    </div>

                    <div id="privacy-field">
                        <?php $checked = $form->get('privacy') ? 'checked="checked"' : '' ?>
                        <label for="privacy-check" id="privacy-check-label">
                            <span class="error-wrapper"><input type="checkbox" id="privacy-check" name="privacy" <?= $checked ?>></span> I agree to the <a href="/en-US/privacy-policy">Privacy Policy</a>
                        </label>
                    </div>

                    <input name="submit" type="submit" value="Sign me up!" id="subscribe"
                           onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                                  'DCS.dcsuri', '/mainstream_newsletter/signup',
                                                  'WT.ti', 'Link: Sign me up - Second Step',
                                                  'WT.dl', 99,
                                                  'WT.nv', 'Content',
                                                  'WT.ac', 'Newsletter');">
                    <p class="footnote">We will only send you Mozilla-related information.</p>
                </div>

            </li>
            <li id="success-pane">
                <h3>Thanks for Subscribing!</h3>
                <p>We look forward to soon begin sharing tips &amp; tricks on getting the most out of Firefox, as well as exciting news about Mozilla and how we’re working to create a better Web.</p>
            </li>
        </ul>
        </form>
    </div></div>

    <div class="sub-feature" id="personalize">
        <div id="personalize-live" class="container">
            <h3><a href="http://firefoxlive.mozilla.org/"
                   onclick="dcsMultiTrack('DCS.dcssip', 'firefoxlive.mozilla.org', 'DCS.dcsuri', '/', 'WT.ti', 'Firefox%20Live');">
                Firefox <span>Live</span>
            </a></h3>
            <p>A live feed of firefox cubs. Can you handle the cute?</p>
            <ul class="link"><li>
                <a href="http://firefoxlive.mozilla.org/"
                   onclick="dcsMultiTrack('DCS.dcssip', 'firefoxlive.mozilla.org', 
                                          'DCS.dcsuri', '/',
                                          'WT.ti', 'Link: View the Cubs',
                                          'WT.dl', 99,
                                          'WT.nv', 'Content',
                                          'WT.ac', 'Firefox Live');">
                  View the cubs
                </a>
            </li></ul>
        </div>
    </div>

    <div class="sub-feature" id="social">
        <ul class="link">
            <li id="connect-twitter">
              <a href="http://twitter.com/firefox"
                 onclick="dcsMultiTrack('DCS.dcssip', 'twitter.com',
                                        'DCS.dcsuri', '/firefox',
                                        'WT.ti', 'Link: Twitter',
                                        'WT.dl', 99,
                                        'WT.nv', 'Footer',
                                        'WT.ac', 'Twitter');">
                Twitter
              </a>
            </li>
            <li id="connect-facebook">
              <a href="http://www.facebook.com/Firefox"
                 onclick="dcsMultiTrack('DCS.dcssip', 'www.facebook.com',
                                        'DCS.dcsuri', '/firefox',
                                        'WT.ti', 'Link: Facebook',
                                        'WT.dl', 99,
                                        'WT.nv', 'Footer',
                                        'WT.ac', 'Facebook');">
                Facebook
              </a>
            </li>
            <li id="connect-participate">
              <a href="/<?=$lang?>/about/participate/"
                 onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                        'DCS.dcsuri', '/<?=$lang?>/about/participate/',
                                        'WT.ti', 'Link: Participate',
                                        'WT.dl', 99,
                                        'WT.nv', 'Footer',
                                        'WT.ac', 'Participate');">
                Participate
              </a>
            </li>
        </ul>
    </div>

    <div class="sub-feature" id="flash-plus-beta" style="display: none;">
        <a href="/<?=$lang?>/firefox/beta/"
           onclick="dcsMultiTrack('DCS.dcsuri', '/<?=$lang?>/firefox/beta/', 'WT.ti', 'Flash-Beta');">
          <img src="<?php echo min_inline_image('/img/firefox/3.6/firstrun/beta-logo.png')?>" alt="Firefox 4 Beta" width="129" height="30" />
        </a>
        <p>Try the Firefox 4 Beta for speedier browsing and awesome new features.</p>
        <ul class="link">
            <li>
              <a href="/<?=$lang?>/firefox/beta/"
                 onclick="dcsMultiTrack('DCS.dcsuri', '/<?=$lang?>/firefox/beta/', 'WT.ti', 'Flash-Beta');">
                Free Download
              </a>
            </li>
        </ul>
    </div>

</div>

<p id="sub-links">
    <a href="/<?=$lang?>/firefox/<?=$_version?>/releasenotes/">Release Notes <span>»</span></a>
    <a href="/<?=$lang?>/firefox/features/">Firefox Features <span>»</span></a>
    <a href="http://support.mozilla.com">Firefox Help <span>»</span></a>
</p>

<?php
$detect_flash = FALSE;
include_once "{$config['file_root']}/{$lang}/includes/footers/3.6/portal-pages.inc.php";

?>

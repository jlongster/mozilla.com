<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="preload" href="/img/firefox/4.0/firstrun/effects.svg">
    <link rel="stylesheet" href="/style/firefox/4/firstrun-page.css">
    <style>
      #tour .callout path {
          fill: #fff;
      }
      #tour .callout:hover path {
          fill: url(#hover);
          filter: url(#f_hover);
          stroke: #485e9b;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <header>
        <img id="logo" src="/img/firefox/4.0/firstrun/FxLogo.png" width="116"â€†height="124" alt="Firefox Logo">
        <div id="header">
          <h1 class="wordmark">mozilla Firefox</h1>
          <aside>
            Made by a global non-profit dedicated to
            shaping the future of the Web for the
            public good.
            <a href="http://mozilla.org/about">Learn more&nbsp;&raquo;</a>
          </aside>
        </div>
      </header>
      <div id="content">
        <nav>
          <section class="meet">
            <h2>Step 1: <b>Meet Firefox 4</b></h2>
            <a class="emblem" title="play video">
              <svg width="18" height="17">
                <polygon fill="#ffffff" points="0 0, 18 9, 0 17">
              </svg>
            </a>
          </section>
          <section class="know">
            <h2>Step 2: <b>Know Your Browser</b></h2>
            <a class="emblem" title="start tour">&raquo;</a>
          </section>
        </nav>
        <footer>
          <div id="newsletter-signup">
            <div class="title">
              <h3>Keep In Touch</h3>
              <div class="more">
                <h4>Get Monthly News!</h4>
                <p>Sign up to get our monthly newsletter featuring
                   special Mozilla news, Firefox tips & tricks, and more!
              </div>
            </div>
            <form id="email-form" action="#email-form" method="post">
              <input name="email" type="email" placeholder="Your email address"><a class="button" href="#newsletter-signup" id="expand"><b>&raquo</b></a>
              <div class="more">
                <div class="row">
                  <select id="country" name="country">
                      <option value="">Select country</option>
                  </select>
                </div>
                <div class="row"> 
                    <label for="html-format"><input type="radio" name="format" id="html-format" value="html"> HTML</label>
                    <label for="text-format"><input type="radio" name="format" id="text-format" value="text"> Text</label>&nbsp;
                </div>
                <div class="row">
                    <label for="privacy-check" id="privacy-check-label">
                        <input type="checkbox" id="privacy-check" name="privacy">I agree to the <a href="/en-US/privacy-policy">Mozilla Privacy Policy</a>
                    </label>
                </div>
                <input name="submit" class="button" type="submit" value="Sign me up!" id="subscribe"
                       onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                'DCS.dcsuri', '/mainstream_newsletter/signup',
                                'WT.ti', 'Link: Sign me up - Second Step',
                                'WT.dl', 99,
                                'WT.nv', 'Content',
                                'WT.ac', 'Newsletter');">
                <p class="footnote">We will only send you Mozilla-related information.</p>
              </div>
            </form>
          </div>
          <div class="promo">
            <a href="http://twitterparty.mozilla.org/"
               onmousedown="dcsMultiTrack('DCS.dcsuri', '/button/firstrun/twitter.html', 'WT.ti', 'First%20Run%20%20Twitter');"
               class="button" id="twitter"><img src="/img/firefox/4.0/firstrun/twitter-badge.png">Join the party&nbsp;&raquo;</a>
            <a href="http://www.facebook.com/Firefox?v=app_122300121174636"
               onmousedown="dcsMultiTrack('DCS.dcsuri', '/button/firstrun/facebook.html', 'WT.ti', 'First%20Run%20%20Facebook');"
               class="button" id="facebook"><img src="/img/firefox/4.0/firstrun/fb-badge.png">Facebook badges&nbsp;&raquo;</a>
          </div>
        </footer>
      </div>
    </div>
    <div id="video">
      <a href="#" id="video-close">close</a>
      <video src="http://videos-cdn.mozilla.net/serv/marketing/firefox4/FF4_Jess3Features_VO_1.webm" controls></video>
    </div>
    <div id="tour">
    </div>
    <div id="overlay"></div>
    <svg>
      <defs>
        <linearGradient id="hover" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#7ba9e5; stop-opacity:1"/>
          <stop offset="100%" style="stop-color:#4763b2; stop-opacity:1"/>
        </linearGradient>
        <filter id="f_hover">
          <feFlood flood-color="#000000" flood-opacity=".15" result="flood"/>
          <feComposite in="flood" in2="SourceAlpha" operator="in" result="platter"/>
          <feOffset in="platter" result="drop-shadow" dx="0" dy="5"/>

          <feFlood flood-color="#485e9b" result="is1"/>
          <feComposite in="is1" in2="SourceAlpha" operator="in" result="is2"/>
          <feOffset in="is2" result="is3" dx="0" dy="4"/>
          <feComposite in="is3" in2="SourceAlpha" operator="out" result="is4"/>
          <feOffset in="is4" result="inner-shadow" dx="0" dy="-4"/>

          <feMerge>
            <feMergeNode in="drop-shadow"/>
            <feMergeNode in="SourceGraphic"/>
            <feMergeNode in="inner-shadow"/>
          </feMerge>
        </filter>
        <filter id="normal" filterUnits="userSpaceOnUse">
          <feFlood flood-color="#000000" flood-opacity=".15" result="flood"/>
          <feComposite in="flood" in2="SourceAlpha" operator="in" result="platter"/>
          <feOffset in="platter" result="drop-shadow" dx="0" dy="5"/>

          <feFlood flood-color="#000000" flood-opacity=".15" result="is1"/>
          <feComposite in="is1" in2="SourceAlpha" operator="in" result="is2"/>
          <feOffset in="is2" result="is3" dx="0" dy="5"/>
          <feComposite in="is3" in2="SourceAlpha" operator="out" result="is4"/>
          <feOffset in="is4" result="inner-shadow" dx="0" dy="-6"/>

          <feMerge>
            <feMergeNode in="drop-shadow"/>
            <feMergeNode in="SourceGraphic"/>
            <feMergeNode in="inner-shadow"/>
          </feMerge>
        </filter>
      </defs>
    </svg>
    <script>
      function getTop(el) {
          if (!el.offsetParent) return 0;
          return el.offsetTop + getTop(el.offsetParent);
      }
      function getLeft(el) {
          if (!el.offsetParent) return 0;
          return el.offsetLeft + getLeft(el.offsetParent);
      }

      $ = document.querySelector.bind(document);
      function $$(s, fn) {
          var nl = document.querySelectorAll(s), item;
          for (var i = 0; i < nl.length; ++i) {
              item = nl[i];
              fn.apply(item);
          }
      }

      window.addEventListener("DOMContentLoaded", init, false);

      function init() {
        var body = document.body,
            vid = $("video");
            window.vid = vid;

        $(".know").addEventListener("transitionend", function() {
          if (body.classList.contains("lightbox")) {
            posTour();
            body.classList.add("tour");
          }
        }, true);

        $("#tour").addEventListener("transitionend", function() {
          if (!body.classList.contains("tour")) {
            body.classList.remove("lightbox");
          }
        }, true);

        function posTour() {
          $("#tour").style.top = getTop($(".know")) + "px";
        }
        window.addEventListener("resize", function() {
          posTour();
        }, false);

        $(".know").addEventListener("click", function() {
          body.classList.add("lightbox");
        }, false);

        $(".meet").addEventListener("click", function() {
          body.classList.add("video");
        }, false);
        $("#video").addEventListener("transitionend", function(e) {
          if (e.originalTarget == $("video") && body.classList.contains("video")) {
            setTimeout(function() {
              vid.load();
            }, 1000);
          }
        }, false);

        $("#video-close").addEventListener("click", function(e) {
          e.preventDefault();
          vid.pause();
          body.classList.remove("video");
        }, false);

        function bindTour() {
          $$("#tour .tip .callout, #tour .tip .emblem", function() {
            this.addEventListener("mouseover", function(e) {
              e.target.parentNode.classList.add("show");
            }, false);
            this.addEventListener("mouseout", function(e) {
              e.target.parentNode.classList.remove("show");
            }, false);
          });

          $("#tour-close").addEventListener("click", function(e) {
            e.preventDefault();
            body.classList.remove("tour");
          }, false);
        }

        function fetchTour() {
          var req = new XMLHttpRequest();
          req.open('GET', 'tour_' + platform + '.html', false);
          req.onreadystatechange = function () {
            if (req.readyState == 4) {
              if(req.status == 200) {
                $("#tour").innerHTML = req.responseText;
                bindTour();
                posTour();
              }
            }
          };
          req.send(null);
        }

        fetchTour();
      }
      
      var platform = (function() {
        var ua = navigator.userAgent;
        if (ua.indexOf("Mac") != -1) {
          return "mac";
        } else if (ua.indexOf("Linux") != -1) {
          return "linux";
        }
        return "win";
      })();
      document.body.classList.add(platform);
    </script>
  </body>
</html> 
<?php
    require_once "{$config['file_root']}/includes/min/inline.php";

    $page_title = 'Mozilla Firefox Web Browser â€” Free Download';
    $body_id    = 'home';

    $fonts      = ' '; // Remove fonts cause IE will download them anyway
    $styles     = ' ';
    $all_css    = min_inline_css('css');
    $home_css   = min_inline_css('css_home');

    $extra_headers = <<<EXTRA_HEADERS
    <!-- Please do not ever remove this comment. -->
    <meta name="keywords" content="Firefox, Mozilla Firefox, Mozilla, Thunderbird, Thunderbird 2, Thunderbird email, email, Firefox 2, Foxfire, Fire Fox, browser, web browser, internet browser, web, pop-up blocker, internet, speed, secure, customize, online, add-ons, fastest, download Firefox" />
    <meta name="description" content="Mozilla Firefox is created by a global non-profit dedicated to putting individuals in control and shaping the future of the web for the public good." />
    <meta name="WT.ad" content="Download Firefox;Tour;Security;Go Fast;Customize;Beta" />
    {$all_css}
    {$home_css}
EXTRA_HEADERS;

    $head_scripts = min_inline_js('js_utils');
    include_once "{$config['file_root']}/{$lang}/includes/header.inc.php";
?>
<?php
    // Funnelcake Config
    $_product_details_options = array();
    if (array_key_exists('funnelcake_suffix', $config) && !empty($config['funnelcake_suffix'])) {
        $_product_details_options['tweaks'] = array('/'.LATEST_FIREFOX_VERSION.'/' => LATEST_FIREFOX_VERSION.$config['funnelcake_suffix']);
        echo <<<FUNNEL
<script>// <![CDATA[
  var gDownloadFunnelCake = '{$config['funnelcake_suffix']}';
// ]]></script>
FUNNEL;
    }
?>

<div id="main-feature">
    <h2>Made to make the Web a better place.</h2>
    <ul id="benefits">
        <li class="first">a new <span>look</span></li>
        <li>super <span>speed</span></li>
        <li>even more <span>awesomeness</span></li>
    </ul>
    <?=buildPlatformImage($config['static_prefix'].'/img/covehead/firefox/main-feature.png', 'Firefox screenshot', null, null, 'screenshot', array('mac', 'linux'))?>
    <div id="download-stats">
        <h4>Team <em>Firefox</em></h4>
        <p>
            <span id="download-count"><?php

$downloadFallbackText = 'Millions of';

$file = "{$config['file_root']}/includes/firefox_4_final_downloads_total.json";
if (file_exists($file) && is_readable($file)) {
    $json = json_decode(file_get_contents($file), true);
    if ($json === null) {
        $downloads = $downloadFallbackText;
    } else {
        $downloads = $json['4.0'];
        $downloads = number_format($downloads);
    }
} else {
    $downloads = $downloadFallbackText;
}

echo $downloads;

?></span>
            <span id="text">downloads and counting!</span>
        </p>
    </div>
    <div id="home-download">
    <script><?php include $config['file_root'] . '/js/download.old.js';?></script>
    <script>
        <!--
        // Configure the Firefox download write script

        var gDownloadTracker = "dcsMultiTrack('DCS.dcssip', 'www.mozilla.com', 'DCS.dcsuri', '/en-US/products/download.html', 'WT.ti', 'Link: Get Firefox', 'WT.dl', 99, 'WT.nv', 'Content', 'WT.ac', 'Download Firefox');";

        var gDownloadItemTemplate = " <li class=\"%CSS_CLASS%\"> <a onclick=\"" + gDownloadTracker + " do_download('%BOUNCER_URL%');\" href=\"%DOWNLOAD_URL%\" class=\"download-link download-firefox\"><span class=\"download-content\"><span class=\"download-title\">Firefox <img src=\"<?=$config['static_prefix']?>/img/home/download-arrow.png\" alt=\"\" id=\"download-arrow\"></span> Free Download <span class=\"download-info\">%VERSION% for %PLATFORM_NAME% <em class=\"download-lang\">%LANGUAGE_NAME%<\/em><\/span><\/span><\/a> <\/li>";
        var gDownloadItemMacOS9 = "<a href=\"\">MacOS 9 and earlier are not supported<\/a>";
        var gDownloadItemOtherPlatform = "<a href=\"/<?=$lang?>/firefox/<?=LATEST_FIREFOX_VERSION?>/releasenotes/#contributedbuilds\" onclick=\"" + gDownloadTracker + "\">Free Download<\/a>"

        document.writeln("<ul class=\"home-download " + gCssClass + " \">");
        writeDownloadItems("fx");
        document.writeln("<\/ul>");
        document.writeln("<div class=\"download-other\">");
        document.writeln("<a href=\"\/<?=$lang?>\/firefox\/all.html\">All Systems &amp; Languages<\/a> | ");
        document.writeln("<a href=\"\/<?=$lang?>\/legal\/privacy\/firefox.html\">Privacy Policy<\/a>");
        document.writeln("<\/div>");
        //-->
    </script>
    <?php echo $firefoxDetails->getNoScriptBlockForLocale('en-US', $_product_details_options); ?>
    </div>
    <script>
    if(/(PPC|Mac OS X 10.[0-4])/.test(navigator.userAgent)) {
        var div = document.getElementById('home-download');
        div.innerHTML = 'Unfortunately the latest version of Firefox isn\'t compatible with your computer\'s operating system. <a href="/firefox/4.0/system-requirements/">Learn more</a>.';
        div.style.width = '400px';
        div.style.marginBottom = '50px';
    }
    </script>

    <p id="mobile-promo">
      <a href="/<?=$lang?>/mobile/?WT.mc_id=hp_1&amp;WT.mc_ev=click"
         onclick="dcsMultiTrack('DCS.dcssip', 'www.mozilla.com',
                                'DCS.dcsuri', '/<?=$lang?>/mobile/',
                                'WT.ti', 'Link: Get Firefox on your phone!',
                                'WT.dl', 99,
                                'WT.nv', 'Content',
                                'WT.ac', 'Mobile');">Get Firefox on your phone!</a>
    </p>

</div>

<hr class="hide" />

<!-- Please do not ever remove this comment. -->

<script>
// <![CDATA[

// Includes jquery and then nav-main.js after onload
(function () {
    var head = document.head || document.getElementsByTagName("head")[0];

    function init_video()
    {
        Mozilla.VideoPlayer.width = 640;
        Mozilla.VideoPlayer.height = 360;
        var player = new Mozilla.VideoPlayer(
            'video-link',
            [
                {
                    url:   'http://videos-cdn.mozilla.net/serv/marketing/firefox4/FF4_Jess3Features_VO_1.webm',
                    type:  'video/webm; codecs=&quot;vp8, vorbis&quot;',
                    title: 'WebM format'
                },
                {
                    url:   'http://videos-cdn.mozilla.net/serv/marketing/firefox4/FF4_Jess3Features_VO_1.theora.ogv',
                    type:  'video/ogg; codecs=&quot;theora, vorbis&quot;',
                    title: 'Ogg&nbsp;Theora format'
                },
                {
                    url:   'http://videos-cdn.mozilla.net/serv/marketing/firefox4/FF4_Jess3Features_VO_1.mp4',
                    type:  'video/mp4',
                    title: 'MPEG-4 format'
                }
            ],
            'serv/marketing/firefox4/FF4_Jess3Features_VO_1.mp4',
            true
        );
    }

    function load_video()
    {
        var scriptElem = document.createElement("script");
        var scriptDone = false;
        scriptElem.onload = scriptElem.onreadystatechange = function () {
            if ((scriptElem.readyState && scriptElem.readyState !== "complete" && scriptElem.readyState !== "loaded") || scriptDone) {
                return false;
            }
            scriptElem.onload = scriptElem.onreadystatechange = null;
            scriptDone = true;
            init_video();
        };
        scriptElem.src = "<?php echo $config['static_prefix'];?>/js/mozilla-video-tools.js";
        head.insertBefore(scriptElem, head.firstChild);
    }

    function load_nav_main()
    {
        var scriptElem = document.createElement("script");
        scriptElem.src = "<?php echo $config['static_prefix'];?>/js/nav-main.js";
        head.insertBefore(scriptElem, head.firstChild);
    }

    function load_jquery ()
    {
        var scriptElem = document.createElement("script");
        var scriptDone = false;
        scriptElem.onload = scriptElem.onreadystatechange = function () {
            if ((scriptElem.readyState && scriptElem.readyState !== "complete" && scriptElem.readyState !== "loaded") || scriptDone) {
                return false;
            }
            scriptElem.onload = scriptElem.onreadystatechange = null;
            scriptDone = true;
            load_nav_main();
            load_video();
        };
        scriptElem.src = "<?php echo $config['static_prefix'];?>/js/jquery/jquery.min.js";
        head.insertBefore(scriptElem, head.firstChild);
    }

    var old_onload = window.onload;
    if (old_onload) {
        window.onload = function() { old_onload(); load_jquery(); };
    } else {
        window.onload = load_jquery;
    }

})();
// ]]>
</script>

<?php

$extra_footers = <<<EXTRA_FOOTERS
  <div class="footer-links">
    <a href="/firefox/central/">Tour</a> &nbsp;|&nbsp;
    <a href="/firefox/features/">Desktop</a> &nbsp;|&nbsp;
    <a href="/mobile/">Mobile</a> &nbsp;|&nbsp;
    <a href="https://addons.mozilla.org/">Add-Ons</a> &nbsp;|&nbsp;
    <a href="http://support.mozilla.com/">Support</a> &nbsp;|&nbsp;
    <a href="/about/">About</a>

    <div class="footer-privacy">
      <a href="/privacy-policy.html">Privacy Policy</a> &nbsp;|&nbsp;
      <a href="/en-US/about/legal.html">Legal Notices</a>
    </div>
  </div>
EXTRA_FOOTERS;

    include_once "{$config['file_root']}/includes/footer-home.inc.php";
?>
